<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Tina Function. Tina Is Not Alignment. — tina • ImperialNMRTool</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Tina Function. Tina Is Not Alignment. — tina"><meta property="og:description" content="This is a bit of a semantic argument, but spectral alignment typically refers to
modifying spectra or reposition peaks such that they align with each other from
sample to sample. Because we've done FSE, features have much more information
which allows them to be detected in multiple regions combined by shape similarity.
Instead of modifying spectra, TINA reformulates alignment as a clustering
problem in feature (shape) space."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ImperialNMRTool</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Tina Function. Tina Is Not Alignment.</h1>
    
    <div class="hidden name"><code>tina.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is a bit of a semantic argument, but spectral alignment typically refers to
modifying spectra or reposition peaks such that they align with each other from
sample to sample. Because we've done FSE, features have much more information
which allows them to be detected in multiple regions combined by shape similarity.
Instead of modifying spectra, TINA reformulates alignment as a clustering
problem in feature (shape) space.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tina</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>pars</dt>
<dd><p>A list of parameters for the TINA pipeline.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list containing the results and cluster labels from TINA</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>There are also several filtering steps employed before this.
We cannot eliminate all poor shapes, but there are a couple of useful heuristics
which generally reduce unnecessary computation downstream. First, there are many
feature shapes which are either quite poor in quality, or do not contain
sufficient information to be useful for annotation. We keep features with:
  - in defined ppm range (generally [-1, 11])
  - long enough runs? (contains runs &gt; noisewidth*3 adjacent points)
  - large enough subset? (&gt;= 5 spectra with feature, good correlation reliability)
  - has at least 1 true peak &gt; 0.3 of the range of intensities? (not just the
    side of a broad peak; not monotonic)
Since the same features will often be extracted multiple times (either in the
same spectral region, or other regions; i.e. same peak, but misaligned), it is
advantageous to reduce this redundancy by clustering feature shapes. We accomplish
this using a combination of UMAP projection and Affinity Propagation clustering.
Before comparing feature shapes, we align them to their maximum intensity
resonance. This is quick, and usually performs well enough.
UMAP uses euclidean distance as a default. In practice, UMAP is able to sort
feature shapes into tight clusters when low n_neighbors (e.g. 5) and min_dist
(e.g. 0.05) are used. This does not capture global relationships as well, but
we only use it to identify tight clusters.
All pairwise correlations (PCCs) are calculated for the feature shapes. A mask
for correlation thresholding is applied to the distance matrix (generated using
apcluster::negDistMat(pts, r=2), squared negative euclidean distance) to ensure
that clustered features have a high correlation as well. apcluster uses a q
parameter to optimize the initial preferences. Higher q -&gt; stricter clusters.
Raising the lambda (dampening) parameter helps avoid oscillations which prevent
convergence, although raising this too high can make updates too slow to
converge within the number of iterations.
See
https://cran.r-project.org/web/packages/apcluster/vignettes/apcluster.pdf for
a full description of affinity propagation parameters
Ultimately, it doesn't matter much what clustering method is used, as this is
primarily a means of combining highly similar features to reduce the computational
burden of pairwise comparisons to reference spectra.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael T. Judge PostDoc / Developer, Goncalo G. Graca PostDoc / Developer, Callum Martin Developer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

