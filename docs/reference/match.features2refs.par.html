<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Match STORM features to GISSMO database using parallel computing — match.features2refs.par • ImperialNMRTool</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Match STORM features to GISSMO database using parallel computing — match.features2refs.par"><meta property="og:description" content="This function matches STORM'd feature shapes to a reference database using cross-correlation,
least-squares fitting, and peak quality weighting. The matching process is parallelized
for speed, and results are saved as an RDS file. The function reads in parameters from
a YAML file and data from RDS files generated by previous function calls (from fse() and tina())"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ImperialNMRTool</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Match STORM features to GISSMO database using parallel computing</h1>
    
    <div class="hidden name"><code>match.features2refs.par.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function matches STORM'd feature shapes to a reference database using cross-correlation,
least-squares fitting, and peak quality weighting. The matching process is parallelized
for speed, and results are saved as an RDS file. The function reads in parameters from
a YAML file and data from RDS files generated by previous function calls (from fse() and tina())</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">match.features2refs.par</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>pars</dt>
<dd><p>a list of parameters for matching, read in from a YAML file</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>nothing; results are saved as an RDS file</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Matching:
Matching is accomplished by cross-correlating all pairwise feature - reference
spectrum pairs. Since there are feature-level comparisons to make (i.e. a single
feature across all matches), iteration over features is serial. Iteration over
references for each feature is done in parallel. This comparison is not optimal,
but works as a proof of concept and can be scaled up. Increasing numbers of
features results in a linear increase in computational time, but also more memory
usage for each core. Generally, it is advisable to leave 1 or 2 cores on one's
machine free for system operations and the main R instance. For each comparison
that is, for each feature - reference pair being tested, the top max.hits
(e.g., 5) convolution hits are assessed for pearson correlation coefficient
(r.thresh) and pvalue (p.thresh). For hits passing both thresholds, the feature
is fit to the reference using least squares. RMSE is reported.</p>
<p>Next, it's best to avoid penalizing a feature fit just because it contains false
positive points. Once a feature has been fit to all reference spectra (at 0-5
more places), resonances which were never fit are identified using peak poorness:
1) Line up all fits for that feature across the database.
2) For each fit, take the positive residuals, divide by feature intensity. If
   values are close to 1, the feature was completely absent in the ref
   signature at those point. This is a measure of ~ peak poorness for this database
3) Take the mean of those values across all fits for each point in the feature.
4) Square peak-poorness to squash them down unless very high:
    peak.quality = 1-(peak.poorness^2)
5) For each fit's non-missing values:
    rmse.weighted = sum(residuals * peak.quality)/n.points</p>
<p>This metric appears to give more intuitive results. Missing reference resonances
compared to the feature is preferable to the opposite, which will be measured
during backfitting.
Matches are written to file.
Note: matching in parallel is much lighter (~50<!-- %) if run in a new R instance -->
outside of RStudio due to memory leaks/overhead.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael T. Judge PostDoc / Developer, Goncalo G. Graca PostDoc / Developer, Callum Martin Developer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

