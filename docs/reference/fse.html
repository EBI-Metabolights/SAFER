<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>FSE Function — fse • ImperialNMRTool</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="FSE Function — fse"><meta property="og:description" content="Extracts feature shapes from a matrix of NMR spectra using the FSE algorithm.
# FSE: the spectral matrix is decomposed into compound features using feature
shape extraction. First, a local STOCSY is performed at every point along the
spectrum (within a sliding window of ~ 100 points; enough to capture multiple
resonances within any multiplet). For each of these STOCSYs, the central peak
in the correlation profile (correlation pocket; corrpocket) typically captures
a resonance, as the correlation is 1 by definition at the STOCSY'd point, and
typically falls off as you approach the boundaries of the resonance. This is
taken, with the next highest correlation peak within the window, to form a
rough statistical description of two resonances which have an correlation in
intensity across samples, albeit separated by chemical shift. We term this a
'protofeature'. Importantly, each point and its associated window will capture
the dominant protofeature most associated with that point. This changes for
adjacent points, and many protofeatures will be duplicated multiple times. A
protofeature should be considered as a rough hypothesis about a statistical
association between two resonances, which happen to be sufficiently aligned
so that they produce a coherent signal.
If the windows are all aligned, we can plot the 
each window point. From this distribution, it is clear that nearly all
protofeatures, including those from noise peaks and real peaks, include the
most central window points. As such, these cannot reliably be used to identify
noise. However, the correlation peak about noise tends to be much smaller, and
characteristically so. As such, a noisewidth can be estimated from this
distribution. This is the origin of the noise.percentile cutoff, which is applied
like so: &quot;given a noise.percentile = 0.99, consider only those protofeatures
for which both peaks have a width &amp;gt; the smallest 1
number therefore gives a more selective cut. Protofeatures are also filtered so
that they must be bidirectional (i.e. both peaks must indicate each other as
highest correlated), and must include runs &amp;gt; noise.width."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ImperialNMRTool</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>FSE Function</h1>
    
    <div class="hidden name"><code>fse.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extracts feature shapes from a matrix of NMR spectra using the FSE algorithm.
# FSE: the spectral matrix is decomposed into compound features using feature
shape extraction. First, a local STOCSY is performed at every point along the
spectrum (within a sliding window of ~ 100 points; enough to capture multiple
resonances within any multiplet). For each of these STOCSYs, the central peak
in the correlation profile (correlation pocket; corrpocket) typically captures
a resonance, as the correlation is 1 by definition at the STOCSY'd point, and
typically falls off as you approach the boundaries of the resonance. This is
taken, with the next highest correlation peak within the window, to form a
rough statistical description of two resonances which have an correlation in
intensity across samples, albeit separated by chemical shift. We term this a
'protofeature'. Importantly, each point and its associated window will capture
the dominant protofeature most associated with that point. This changes for
adjacent points, and many protofeatures will be duplicated multiple times. A
protofeature should be considered as a rough hypothesis about a statistical
association between two resonances, which happen to be sufficiently aligned
so that they produce a coherent signal.
If the windows are all aligned, we can plot the <!-- % of central corrpeaks containing -->
each window point. From this distribution, it is clear that nearly all
protofeatures, including those from noise peaks and real peaks, include the
most central window points. As such, these cannot reliably be used to identify
noise. However, the correlation peak about noise tends to be much smaller, and
characteristically so. As such, a noisewidth can be estimated from this
distribution. This is the origin of the noise.percentile cutoff, which is applied
like so: "given a noise.percentile = 0.99, consider only those protofeatures
for which both peaks have a width &gt; the smallest 1<!-- % of peaks". Reducing this -->
number therefore gives a more selective cut. Protofeatures are also filtered so
that they must be bidirectional (i.e. both peaks must indicate each other as
highest correlated), and must include runs &gt; noise.width.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fse</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>pars</dt>
<dd><p>A list of parameters for the function.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list of features extracted from the spectra.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>STORM: Joram Posma's STORM has been adapted and optimized to accept these
protofeatures in the following ways:
- first, since many of the protofeatures are noise, we provide failure modes
  and reporting for the following cases:
  "empty subset",          #' empty subset (no spectrum contains signature)
  "subset degenerated",    #' 1-3 spectra in the subset (not enough spectra to
                             get a reliable correlation)
  "reference degenerated", #' signature degenerates to include &lt; 3 points (not
                             meaningful to correlate shapes)
  "did not converge"       #' subset continues to change after 24 iterations
- additionally, the correlation r and p-value cutoff q are both used during
  both the subset selection and reference update steps.
- we also remove any regions of the reference for which there are fewer than
  minpeak values after r and p value thresholding. This helps avoid noise.</p>
<p>STORM extracts meaningful features using protofeatures to define the region of
interest and a rough sketch of the feature shape highly correlated with each
spectral point. In the future, HCA could be used to cluster potential starting
feature shapes correlated with each driver, or the nonoptimal subset for each
point could be re-STORMed to detect any other feature shapes present. It is
also perfectly reasonable to combine feature shapes from different STORM runs
for a given dataset, as these comprise a list of somewhat independently tested
feature shapes, and duplication is not an issue.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael T. Judge PostDoc / Developer, Goncalo G. Graca PostDoc / Developer, Callum Martin Developer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

